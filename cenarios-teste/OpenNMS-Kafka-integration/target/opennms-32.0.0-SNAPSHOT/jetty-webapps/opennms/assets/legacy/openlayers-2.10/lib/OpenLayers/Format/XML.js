OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){for(var t in window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[e]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={},this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t,this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var a=OpenLayers.Util.Try(OpenLayers.Function.bind((function(){var t;return(t=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom).loadXML(e),t}),this),(function(){return(new DOMParser).parseFromString(e,"text/xml")}),(function(){var t=new XMLHttpRequest;return t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),t.overrideMimeType&&t.overrideMimeType("text/xml"),t.send(null),t.responseXML}));return this.keepData&&(this.data=a),a},write:function(e){var t;if(this.xmldom)t=e.xml;else{var a=new XMLSerializer;if(1==e.nodeType){var r=document.implementation.createDocument("","",null);r.importNode&&(e=r.importNode(e,!0)),r.appendChild(e),t=a.serializeToString(r)}else t=a.serializeToString(e)}return t},createElementNS:function(e,t){return this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t)},createTextNode:function(e){return"string"!=typeof e&&(e=String(e)),this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e)},getElementsByTagNameNS:function(e,t,a){var r=[];if(e.getElementsByTagNameNS)r=e.getElementsByTagNameNS(t,a);else for(var n,i,s=e.getElementsByTagName("*"),o=0,l=s.length;o<l;++o)i=(n=s[o]).prefix?n.prefix+":"+a:a,"*"!=a&&i!=n.nodeName||"*"!=t&&t!=n.namespaceURI||r.push(n);return r},getAttributeNodeNS:function(e,t,a){var r=null;if(e.getAttributeNodeNS)r=e.getAttributeNodeNS(t,a);else for(var n,i=e.attributes,s=0,o=i.length;s<o;++s)if((n=i[s]).namespaceURI==t&&(n.prefix?n.prefix+":"+a:a)==n.nodeName){r=n;break}return r},getAttributeNS:function(e,t,a){var r="";if(e.getAttributeNS)r=e.getAttributeNS(t,a)||"";else{var n=this.getAttributeNodeNS(e,t,a);n&&(r=n.nodeValue)}return r},getChildValue:function(e,t){var a=t||"";if(e)for(var r=e.firstChild;r;r=r.nextSibling)switch(r.nodeType){case 3:case 4:a+=r.nodeValue}return a},concatChildValues:function(e,t){for(var a,r="",n=e.firstChild;n;)(a=n.nodeValue)&&(r+=a),n=n.nextSibling;return""==r&&null!=t&&(r=t),r},isSimpleContent:function(e){for(var t=!0,a=e.firstChild;a;a=a.nextSibling)if(1===a.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,a=!1,r=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,n=e.firstChild;n;n=n.nextSibling){switch(n.nodeType){case 1:a=!0;break;case 8:break;default:t=!0}if(a&&t)break}if(a&&t)r=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(a)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return r},hasAttributeNS:function(e,t,a){return e.hasAttributeNS?e.hasAttributeNS(t,a):!!this.getAttributeNodeNS(e,t,a)},setAttributeNS:function(e,t,a,r){if(e.setAttributeNS)e.setAttributeNS(t,a,r);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(t){var n=e.ownerDocument.createNode(2,a,t);n.nodeValue=r,e.setAttributeNode(n)}else e.setAttribute(a,r)}},createElementNSPlus:function(e,t){var a=(t=t||{}).uri||this.namespaces[t.prefix];if(!a){var r=e.indexOf(":");a=this.namespaces[e.substring(0,r)]}a||(a=this.namespaces[this.defaultPrefix]);var n=this.createElementNS(a,e);t.attributes&&this.setAttributes(n,t.attributes);var i=t.value;return null!=i&&n.appendChild(this.createTextNode(i)),n},setAttributes:function(e,t){var a,r;for(var n in t)null!=t[n]&&t[n].toString&&(a=t[n].toString(),r=this.namespaces[n.substring(0,n.indexOf(":"))]||null,this.setAttributeNS(e,r,n,a))},readNode:function(e,t){t||(t={});var a=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(a){var r=a[e.localName||e.nodeName.split(":").pop()]||a["*"];r&&r.apply(this,[e,t])}return t},readChildNodes:function(e,t){t||(t={});for(var a,r=e.childNodes,n=0,i=r.length;n<i;++n)1==(a=r[n]).nodeType&&this.readNode(a,t);return t},writeNode:function(e,t,a){var r,n,i=e.indexOf(":");i>0?(r=e.substring(0,i),n=e.substring(i+1)):(r=a?this.namespaceAlias[a.namespaceURI]:this.defaultPrefix,n=e);var s=this.writers[r][n].apply(this,[t]);return a&&a.appendChild(s),s},getChildEl:function(e,t,a){return e&&this.getThisOrNextEl(e.firstChild,t,a)},getNextEl:function(e,t,a){return e&&this.getThisOrNextEl(e.nextSibling,t,a)},getThisOrNextEl:function(e,t,a){e:for(var r=e;r;r=r.nextSibling)switch(r.nodeType){case 1:if(!(t&&t!==(r.localName||r.nodeName.split(":").pop())||a&&a!==r.namespaceURI))break e;r=null;break e;case 3:if(/^\s*$/.test(r.nodeValue))break;case 4:case 6:case 12:case 10:case 11:r=null;break e}return r||null},lookupNamespaceURI:function(e,t){var a=null;if(e)if(e.lookupNamespaceURI)a=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){a=e.namespaceURI;break e}var r=e.attributes.length;if(r)for(var n,i=0;i<r;++i){if("xmlns"===(n=e.attributes[i]).prefix&&n.name==="xmlns:"+t){a=n.value||null;break e}if("xmlns"===n.name&&null===t){a=n.value||null;break e}}a=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:a=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:a=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:a=this.lookupNamespaceURI(e.parentNode,t)}return a},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);