OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{EVENT_TYPES:["start","success","fail"],events:null,auto:!1,timer:null,initialize:function(e){OpenLayers.Strategy.prototype.initialize.apply(this,[e]),this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES)},activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.auto&&("number"==typeof this.auto?this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1e3*this.auto):this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.auto&&("number"==typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),e},triggerSave:function(e){var t=e.feature;t.state!==OpenLayers.State.INSERT&&t.state!==OpenLayers.State.UPDATE&&t.state!==OpenLayers.State.DELETE||this.save([e.feature])},save:function(e){e||(e=this.layer.features),this.events.triggerEvent("start",{features:e});var t=this.layer.projection,a=this.layer.map.getProjectionObject();if(!a.equals(t)){for(var r,s,i=e.length,n=new Array(i),o=0;o<i;++o)(s=(r=e[o]).clone()).fid=r.fid,s.state=r.state,r.url&&(s.url=r.url),s._original=r,s.geometry.transform(a,t),n[o]=s;e=n}this.layer.protocol.commit(e,{callback:this.onCommit,scope:this})},onCommit:function(e){var t={response:e};if(e.success()){for(var a,r,s=e.reqFeatures,i=[],n=e.insertIds||[],o=0,l=0,u=s.length;l<u;++l)(a=(r=(r=s[l])._original||r).state)&&(a==OpenLayers.State.DELETE?i.push(r):a==OpenLayers.State.INSERT&&(r.fid=n[o],++o),r.state=null);i.length>0&&this.layer.destroyFeatures(i),this.events.triggerEvent("success",t)}else this.events.triggerEvent("fail",t)},CLASS_NAME:"OpenLayers.Strategy.Save"});