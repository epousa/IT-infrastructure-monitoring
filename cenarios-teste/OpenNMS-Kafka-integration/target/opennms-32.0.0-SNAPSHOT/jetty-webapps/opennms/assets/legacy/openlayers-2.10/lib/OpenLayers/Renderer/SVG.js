OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,isGecko:null,supportUse:null,initialize:function(t){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.supportUse=-1==navigator.userAgent.toLowerCase().indexOf("applewebkit/5"),this.isGecko=-1!=navigator.userAgent.toLowerCase().indexOf("gecko/"),this.symbolMetrics={})},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments)},supported:function(){var t="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(t+"SVG","1.1")||document.implementation.hasFeature(t+"BasicStructure","1.1"))},inValidRange:function(t,e,i){var r=t+(i?0:this.translationParameters.x),n=e+(i?0:this.translationParameters.y);return r>=-this.MAX_PIXEL&&r<=this.MAX_PIXEL&&n>=-this.MAX_PIXEL&&n<=this.MAX_PIXEL},setExtent:function(t,e){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var i=this.getResolution(),r=-t.left/i,n=t.top/i;if(e){this.left=r,this.top=n;var s="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",s),this.translate(0,0),!0}var o=this.translate(r-this.left,n-this.top);return o||this.setExtent(t,!0),o},translate:function(t,e){if(this.inValidRange(t,e,!0)){var i="";return(t||e)&&(i="translate("+t+","+e+")"),this.root.setAttributeNS(null,"transform",i),this.translationParameters={x:t,y:e},!0}return!1},setSize:function(t){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(t,e){var i=null;switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":i=e.externalGraphic?"image":this.isComplexSymbol(e.graphicName)?!1===this.supportUse?"svg":"use":"circle";break;case"OpenLayers.Geometry.Rectangle":i="rect";break;case"OpenLayers.Geometry.LineString":i="polyline";break;case"OpenLayers.Geometry.LinearRing":i="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":i="path"}return i},setStyle:function(t,e,i){e=e||t._style,i=i||t._options;var r,n=parseFloat(t.getAttributeNS(null,"r")),s=1;if("OpenLayers.Geometry.Point"==t._geometryClass&&n){if(t.style.visibility="",!1===e.graphic)t.style.visibility="hidden";else if(e.externalGraphic){r=this.getPosition(t),e.graphicTitle&&t.setAttributeNS(null,"title",e.graphicTitle),e.graphicWidth&&e.graphicHeight&&t.setAttributeNS(null,"preserveAspectRatio","none");var o=e.graphicWidth||e.graphicHeight,l=e.graphicHeight||e.graphicWidth;o=o||2*e.pointRadius,l=l||2*e.pointRadius;var a=null!=e.graphicXOffset?e.graphicXOffset:-.5*o,u=null!=e.graphicYOffset?e.graphicYOffset:-.5*l,h=e.graphicOpacity||e.fillOpacity;t.setAttributeNS(null,"x",(r.x+a).toFixed()),t.setAttributeNS(null,"y",(r.y+u).toFixed()),t.setAttributeNS(null,"width",o),t.setAttributeNS(null,"height",l),t.setAttributeNS(this.xlinkns,"href",e.externalGraphic),t.setAttributeNS(null,"style","opacity: "+h)}else if(this.isComplexSymbol(e.graphicName)){var p=3*e.pointRadius,c=2*p,d=this.importSymbol(e.graphicName);r=this.getPosition(t),s=3*this.symbolMetrics[d][0]/c;var g=t.parentNode,S=t.nextSibling;if(g&&g.removeChild(t),!1===this.supportUse){var y=document.getElementById(d);t.firstChild&&t.removeChild(t.firstChild),t.appendChild(y.firstChild.cloneNode(!0)),t.setAttributeNS(null,"viewBox",y.getAttributeNS(null,"viewBox"))}else t.setAttributeNS(this.xlinkns,"href","#"+d);t.setAttributeNS(null,"width",c),t.setAttributeNS(null,"height",c),t.setAttributeNS(null,"x",r.x-p),t.setAttributeNS(null,"y",r.y-p),S?g.insertBefore(t,S):g&&g.appendChild(t)}else t.setAttributeNS(null,"r",e.pointRadius);var f=e.rotation;if((void 0!==f||void 0!==t._rotation)&&r)if(t._rotation=f,f|=0,"svg"!==t.nodeName)t.setAttributeNS(null,"transform","rotate("+f+" "+r.x+" "+r.y+")");else{var m=this.symbolMetrics[d];t.firstChild.setAttributeNS(null,"transform","rotate("+e.rotation+" "+m[1]+" "+m[2]+")")}}return i.isFilled?(t.setAttributeNS(null,"fill",e.fillColor),t.setAttributeNS(null,"fill-opacity",e.fillOpacity)):t.setAttributeNS(null,"fill","none"),i.isStroked?(t.setAttributeNS(null,"stroke",e.strokeColor),t.setAttributeNS(null,"stroke-opacity",e.strokeOpacity),t.setAttributeNS(null,"stroke-width",e.strokeWidth*s),t.setAttributeNS(null,"stroke-linecap",e.strokeLinecap||"round"),t.setAttributeNS(null,"stroke-linejoin","round"),e.strokeDashstyle&&t.setAttributeNS(null,"stroke-dasharray",this.dashStyle(e,s))):t.setAttributeNS(null,"stroke","none"),e.pointerEvents&&t.setAttributeNS(null,"pointer-events",e.pointerEvents),null!=e.cursor&&t.setAttributeNS(null,"cursor",e.cursor),t},dashStyle:function(t,e){var i=t.strokeWidth*e,r=t.strokeDashstyle;switch(r){case"solid":return"none";case"dot":return[1,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,1,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,1,4*i].join();default:return OpenLayers.String.trim(r).replace(/\s+/g,",")}},createNode:function(t,e){var i=document.createElementNS(this.xmlns,t);return e&&i.setAttributeNS(null,"id",e),i},nodeTypeCompare:function(t,e){return e==t.nodeName},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(t){return this.nodeFactory(this.container.id+t,"g")},createDefs:function(){var t=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(t),t},drawPoint:function(t,e){return this.drawCircle(t,e,1)},drawCircle:function(t,e,i){var r=this.getResolution(),n=e.x/r+this.left,s=this.top-e.y/r;return!!this.inValidRange(n,s)&&(t.setAttributeNS(null,"cx",n),t.setAttributeNS(null,"cy",s),t.setAttributeNS(null,"r",i),t)},drawLineString:function(t,e){var i=this.getComponentsString(e.components);return!!i.path&&(t.setAttributeNS(null,"points",i.path),i.complete?t:null)},drawLinearRing:function(t,e){var i=this.getComponentsString(e.components);return!!i.path&&(t.setAttributeNS(null,"points",i.path),i.complete?t:null)},drawPolygon:function(t,e){for(var i,r,n="",s=!0,o=!0,l=0,a=e.components.length;l<a;l++)n+=" M",(r=(i=this.getComponentsString(e.components[l].components," ")).path)?(n+=" "+r,o=i.complete&&o):s=!1;return n+=" z",!!s&&(t.setAttributeNS(null,"d",n),t.setAttributeNS(null,"fill-rule","evenodd"),o?t:null)},drawRectangle:function(t,e){var i=this.getResolution(),r=e.x/i+this.left,n=this.top-e.y/i;return!!this.inValidRange(r,n)&&(t.setAttributeNS(null,"x",r),t.setAttributeNS(null,"y",n),t.setAttributeNS(null,"width",e.width/i),t.setAttributeNS(null,"height",e.height/i),t)},drawSurface:function(t,e){for(var i=null,r=!0,n=0,s=e.components.length;n<s;n++){if(n%3==0&&n/3==0)(o=this.getShortString(e.components[n]))||(r=!1),i="M "+o;else if(n%3==1){(o=this.getShortString(e.components[n]))||(r=!1),i+=" C "+o}else{var o;(o=this.getShortString(e.components[n]))||(r=!1),i+=" "+o}}return i+=" Z",!!r&&(t.setAttributeNS(null,"d",i),t)},drawText:function(t,e,i){var r=this.getResolution(),n=i.x/r+this.left,s=i.y/r-this.top,o=this.nodeFactory(t+this.LABEL_ID_SUFFIX,"text"),l=this.nodeFactory(t+this.LABEL_ID_SUFFIX+"_tspan","tspan");o.setAttributeNS(null,"x",n),o.setAttributeNS(null,"y",-s),e.fontColor&&o.setAttributeNS(null,"fill",e.fontColor),e.fontOpacity&&o.setAttributeNS(null,"opacity",e.fontOpacity),e.fontFamily&&o.setAttributeNS(null,"font-family",e.fontFamily),e.fontSize&&o.setAttributeNS(null,"font-size",e.fontSize),e.fontWeight&&o.setAttributeNS(null,"font-weight",e.fontWeight),!0===e.labelSelect?(o.setAttributeNS(null,"pointer-events","visible"),o._featureId=t,l._featureId=t,l._geometry=i,l._geometryClass=i.CLASS_NAME):o.setAttributeNS(null,"pointer-events","none");var a=e.labelAlign||"cm";o.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[a[0]]||"middle"),this.isGecko?o.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[a[1]]||"central"):l.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[a[1]]||"-35%"),l.textContent=e.label,o.parentNode||(o.appendChild(l),this.textRoot.appendChild(o))},getComponentsString:function(t,e){for(var i,r,n=[],s=!0,o=t.length,l=[],a=0;a<o;a++)r=t[a],n.push(r),(i=this.getShortString(r))?l.push(i):(a>0&&this.getShortString(t[a-1])&&l.push(this.clipLine(t[a],t[a-1])),a<o-1&&this.getShortString(t[a+1])&&l.push(this.clipLine(t[a],t[a+1])),s=!1);return{path:l.join(e||","),complete:s}},clipLine:function(t,e){if(e.equals(t))return"";var i,r=this.getResolution(),n=this.MAX_PIXEL-this.translationParameters.x,s=this.MAX_PIXEL-this.translationParameters.y,o=e.x/r+this.left,l=this.top-e.y/r,a=t.x/r+this.left,u=this.top-t.y/r;return(a<-n||a>n)&&(i=(u-l)/(a-o),u=l+((a=a<0?-n:n)-o)*i),(u<-s||u>s)&&(i=(a-o)/(u-l),a=o+((u=u<0?-s:s)-l)*i),a+","+u},getShortString:function(t){var e=this.getResolution(),i=t.x/e+this.left,r=this.top-t.y/e;return!!this.inValidRange(i,r)&&i+","+r},getPosition:function(t){return{x:parseFloat(t.getAttributeNS(null,"cx")),y:parseFloat(t.getAttributeNS(null,"cy"))}},importSymbol:function(t){this.defs||(this.defs=this.createDefs());var e=this.container.id+"-"+t;if(null!=document.getElementById(e))return e;var i=OpenLayers.Renderer.symbol[t];if(!i)throw new Error(t+" is not a valid symbol name");var r=this.nodeFactory(e,"symbol"),n=this.nodeFactory(null,"polygon");r.appendChild(n);for(var s,o,l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),a=[],u=0;u<i.length;u+=2)s=i[u],o=i[u+1],l.left=Math.min(l.left,s),l.bottom=Math.min(l.bottom,o),l.right=Math.max(l.right,s),l.top=Math.max(l.top,o),a.push(s,",",o);n.setAttributeNS(null,"points",a.join(" "));var h=l.getWidth(),p=l.getHeight(),c=[l.left-h,l.bottom-p,3*h,3*p];return r.setAttributeNS(null,"viewBox",c.join(" ")),this.symbolMetrics[e]=[Math.max(h,p),l.getCenterLonLat().lon,l.getCenterLonLat().lat],this.defs.appendChild(r),r.id},getFeatureIdFromEvent:function(t){var e=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!1===this.supportUse&&!e){var i=t.target;e=i.parentNode&&i!=this.rendererRoot&&i.parentNode._featureId}return e},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};