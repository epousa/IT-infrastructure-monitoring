OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,initialize:function(e){if(OpenLayers.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!this.featureNS&&this.featurePrefix){var t=this.format.readNode;this.format.readNode=function(e,r){return this.featureNS||e.prefix!=this.featurePrefix||(this.featureNS=e.namespaceURI,this.setNamespace("feature",this.featureNS)),t.apply(this,arguments)}}},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.extend({},e),OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),r=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);return t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:r}),t},handleRead:function(e,t){if(t.callback){var r=e.priv;r.status>=200&&r.status<300?(e.features=this.parseFeatures(r),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e)}},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:null!==this.readFormat?this.readFormat.read(t):this.format.read(t)},commit:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options);var r=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});return r.priv=OpenLayers.Request.POST({url:t.url,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,r,t)}),r},handleCommit:function(e,t){if(t.callback){var r=e.priv,a=r.responseXML;a&&a.documentElement||(a=r.responseText);var s=this.format.read(a)||{};e.insertIds=s.insertIds||[],e.code=s.success?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options);new OpenLayers.Protocol.Response({requestType:"commit"});var r=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),a=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});t.featureNS&&a.setAttribute("xmlns:"+this.featurePrefix,t.featureNS);var s=this.format.writeNode("ogc:Filter",e);a.appendChild(s),r.appendChild(a);var o=OpenLayers.Format.XML.prototype.write.apply(this.format,[r]);return OpenLayers.Request.POST({url:this.url,callback:t.callback||function(){},data:o})},abort:function(e){e&&e.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});