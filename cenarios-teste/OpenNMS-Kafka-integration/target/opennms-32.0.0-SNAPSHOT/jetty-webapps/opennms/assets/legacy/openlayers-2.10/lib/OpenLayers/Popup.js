OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(t,i,e,s,n,o){null==t&&(t=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=t,this.lonlat=i,this.contentSize=null!=e?e:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=s&&(this.contentHTML=s),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.className=this.displayClass;var h=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(h,null,null,null,"relative",null,"hidden");t=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(t,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),this.div.appendChild(this.groupDiv),n&&this.addCloseBox(o),this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.map=null,this.div=null,this.autoSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(t){return null==t&&null!=this.lonlat&&null!=this.map&&(t=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.Util.getBrowserName()||(this.map.events.register("movestart",this,(function(){var t=document.defaultView.getComputedStyle(this.contentDiv,null).getPropertyValue("overflow");"hidden"!=t&&(this.contentDiv._oldOverflow=t,this.contentDiv.style.overflow="hidden")})),this.map.events.register("moveend",this,(function(){var t=this.contentDiv._oldOverflow;t&&(this.contentDiv.style.overflow=t,this.contentDiv._oldOverflow=null)}))),this.moveTo(t),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var t=this.map.getLayerPxFromLonLat(this.lonlat);t&&this.moveTo(t)}},moveTo:function(t){null!=t&&null!=this.div&&(this.div.style.left=t.x+"px",this.div.style.top=t.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){OpenLayers.Element.show(this.div),this.panMapIfOutOfView&&this.panIntoView()},hide:function(){OpenLayers.Element.hide(this.div)},setSize:function(t){this.size=t.clone();var i=this.getContentDivPadding(),e=i.left+i.right,s=i.top+i.bottom;(this.fixPadding(),e+=this.padding.left+this.padding.right,s+=this.padding.top+this.padding.bottom,this.closeDiv)&&(e+=parseInt(this.closeDiv.style.width)+i.right);this.size.w+=e,this.size.h+=s,"msie"==OpenLayers.Util.getBrowserName()&&(this.contentSize.w+=i.left+i.right,this.contentSize.h+=i.bottom+i.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=t.w+"px",this.contentDiv.style.height=t.h+"px")},updateSize:function(){var t="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",i=this.map?this.map.layerContainerDiv:document.body,e=OpenLayers.Util.getRenderedDimensions(t,null,{displayClass:this.displayClass,containerElement:i}),s=this.getSafeContentSize(e),n=null;if(s.equals(e))n=e;else{var o=new OpenLayers.Size;if(o.w=s.w<e.w?s.w:null,o.h=s.h<e.h?s.h:null,o.w&&o.h)n=s;else{var h=OpenLayers.Util.getRenderedDimensions(t,o,{displayClass:this.contentDisplayClass,containerElement:i});if("hidden"!=OpenLayers.Element.getStyle(this.contentDiv,"overflow")&&h.equals(s)){var l=OpenLayers.Util.getScrollbarWidth();o.w?h.h+=l:h.w+=l}n=this.getSafeContentSize(h)}}this.setSize(n)},setBackgroundColor:function(t){null!=t&&(this.backgroundColor=t),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(t){null!=t&&(this.opacity=t),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(t){null!=t&&(this.border=t),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(t){null!=t&&(this.contentHTML=t),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var t=function(){this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad)},i=this.contentDiv.getElementsByTagName("img"),e=0,s=i.length;e<s;e++){var n=i[e];if(0==n.width||0==n.height){var o={popup:this,img:n};n._onImgLoad=OpenLayers.Function.bind(t,o),OpenLayers.Event.observe(n,"load",n._onImgLoad)}}},getSafeContentSize:function(t){var i=t.clone(),e=this.getContentDivPadding(),s=e.left+e.right,n=e.top+e.bottom;(this.fixPadding(),s+=this.padding.left+this.padding.right,n+=this.padding.top+this.padding.bottom,this.closeDiv)&&(s+=parseInt(this.closeDiv.style.width)+e.right);if(this.minSize&&(i.w=Math.max(i.w,this.minSize.w-s),i.h=Math.max(i.h,this.minSize.h-n)),this.maxSize&&(i.w=Math.min(i.w,this.maxSize.w-s),i.h=Math.min(i.h,this.maxSize.h-n)),this.map&&this.map.size){var o=0,h=0;if(this.keepInMap&&!this.panMapIfOutOfView){var l=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":default:o=l.x,h=this.map.size.h-l.y;break;case"tl":o=this.map.size.w-l.x,h=this.map.size.h-l.y;break;case"bl":o=this.map.size.w-l.x,h=l.y;break;case"br":o=l.x,h=l.y}}var a=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-n-h,p=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-s-o;i.w=Math.min(i.w,p),i.h=Math.min(i.h,a)}return i},getContentDivPadding:function(){var t=this._contentDivPadding;return t||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),t=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=t,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),t},addCloseBox:function(t){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17)),this.closeDiv.className="olPopupCloseBox";var i=this.getContentDivPadding();this.closeDiv.style.right=i.right+"px",this.closeDiv.style.top=i.top+"px",this.groupDiv.appendChild(this.closeDiv);var e=t||function(t){this.hide(),OpenLayers.Event.stop(t)};OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(e,this))},panIntoView:function(){var t=this.map.getSize(),i=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),e=i.clone();i.x<this.map.paddingForPopups.left?e.x=this.map.paddingForPopups.left:i.x+this.size.w>t.w-this.map.paddingForPopups.right&&(e.x=t.w-this.map.paddingForPopups.right-this.size.w),i.y<this.map.paddingForPopups.top?e.y=this.map.paddingForPopups.top:i.y+this.size.h>t.h-this.map.paddingForPopups.bottom&&(e.y=t.h-this.map.paddingForPopups.bottom-this.size.h);var s=i.x-e.x,n=i.y-e.y;this.map.pan(s,n)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,scope:this})},onmousedown:function(t){this.mousedown=!0,OpenLayers.Event.stop(t,!0)},onmousemove:function(t){this.mousedown&&OpenLayers.Event.stop(t,!0)},onmouseup:function(t){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(t,!0))},onclick:function(t){OpenLayers.Event.stop(t,!0)},onmouseout:function(t){this.mousedown=!1},ondblclick:function(t){OpenLayers.Event.stop(t,!0)},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px";