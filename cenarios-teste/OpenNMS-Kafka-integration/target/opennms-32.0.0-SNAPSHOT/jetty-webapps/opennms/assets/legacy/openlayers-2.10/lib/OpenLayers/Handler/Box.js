OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxCharacteristics:null,initialize:function(t,e,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);e={down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox};this.dragHandler=new OpenLayers.Handler.Drag(this,e,{keyMask:this.keyMask})},destroy:function(){this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null),OpenLayers.Handler.prototype.destroy.apply(this,arguments)},setMap:function(t){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(t)},startBox:function(t){this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.dragHandler.start),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(t){var e=this.dragHandler.start.x,a=this.dragHandler.start.y,s=Math.abs(e-t.x),o=Math.abs(a-t.y);this.zoomBox.style.width=Math.max(1,s)+"px",this.zoomBox.style.height=Math.max(1,o)+"px",this.zoomBox.style.left=t.x<e?t.x+"px":e+"px",this.zoomBox.style.top=t.y<a?t.y+"px":a+"px";var r=this.getBoxCharacteristics();r.newBoxModel&&(t.x>e&&(this.zoomBox.style.width=Math.max(1,s-r.xOffset)+"px"),t.y>a&&(this.zoomBox.style.height=Math.max(1,o-r.yOffset)+"px"))},endBox:function(t){var e;if(Math.abs(this.dragHandler.start.x-t.x)>5||Math.abs(this.dragHandler.start.y-t.y)>5){var a=this.dragHandler.start,s=Math.min(a.y,t.y),o=Math.max(a.y,t.y),r=Math.min(a.x,t.x),i=Math.max(a.x,t.x);e=new OpenLayers.Bounds(r,o,i,s)}else e=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[e])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.zoomBox=null,this.boxCharacteristics=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return!!OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragHandler.activate(),!0)},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragHandler.deactivate(),!0)},getBoxCharacteristics:function(){if(!this.boxCharacteristics){var t=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"))+1,e=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"))+1,a="msie"!=OpenLayers.Util.getBrowserName()||"BackCompat"!=document.compatMode;this.boxCharacteristics={xOffset:t,yOffset:e,newBoxModel:a}}return this.boxCharacteristics},CLASS_NAME:"OpenLayers.Handler.Box"});