OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(e,t,i){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[e,i]),this.location=t,this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(e,t,i){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(e){var t=e.responseXML;if(t&&t.documentElement||(t=OpenLayers.Format.XML.prototype.read(e.responseText)),this.useFeedTitle){var i=null;try{i=t.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(e){i=t.getElementsByTagName("title")[0].firstChild.nodeValue}i&&this.setName(i)}var r={};OpenLayers.Util.extend(r,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(r.externalProjection=this.projection,r.internalProjection=this.map.getProjectionObject());for(var s=new OpenLayers.Format.GeoRSS(r).read(t),a=0,o=s.length;a<o;a++){var n={};if((y=s[a]).geometry){var l=y.attributes.title?y.attributes.title:"Untitled",p=y.attributes.description?y.attributes.description:"No description.",u=y.attributes.link?y.attributes.link:"",h=y.geometry.getBounds().getCenterLonLat();if(n.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone(),n.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120),l||p){n.title=l,n.description=p;var c='<div class="olLayerGeoRSSClose">[x]</div>';c+='<div class="olLayerGeoRSSTitle">',u&&(c+='<a class="link" href="'+u+'" target="_blank">'),c+=l,u&&(c+="</a>"),c+="</div>",c+='<div style="" class="olLayerGeoRSSDescription">',c+=p,c+="</div>",n.popupContentHTML=c}var y=new OpenLayers.Feature(this,h,n);this.features.push(y);var d=y.createMarker();d.events.register("click",y,this.markerClick),this.addMarker(d)}}this.events.triggerEvent("loadend")},markerClick:function(e){var t=this==this.layer.selectedFeature;this.layer.selectedFeature=t?null:this;for(var i=0,r=this.layer.map.popups.length;i<r;i++)this.layer.map.removePopup(this.layer.map.popups[i]);if(!t){var s=this.createPopup();OpenLayers.Event.observe(s.div,"click",OpenLayers.Function.bind((function(){for(var e=0,t=this.layer.map.popups.length;e<t;e++)this.layer.map.removePopup(this.layer.map.popups[e])}),this)),this.layer.map.addPopup(s)}OpenLayers.Event.stop(e)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var e=this.features[0];OpenLayers.Util.removeItem(this.features,e),e.destroy()}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});