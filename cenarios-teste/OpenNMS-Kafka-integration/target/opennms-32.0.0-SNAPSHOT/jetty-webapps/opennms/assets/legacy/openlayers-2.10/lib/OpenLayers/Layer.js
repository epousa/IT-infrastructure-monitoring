OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend"],RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],metadata:{},initialize:function(t,i){this.addOptions(i),this.name=t,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)),this.wrapDateLine&&(this.displayOutsideMaxExtent=!0)},destroy:function(t){null==t&&(t=!0),null!=this.map&&this.map.removeLayer(this,t),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(t){return null==t&&(t=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(t,this),t.map=null,t},getOptions:function(){var t={};for(var i in this.options)t[i]=this[i];return t},setName:function(t){t!=this.name&&(this.name=t,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(t){if(null==this.options&&(this.options={}),OpenLayers.Util.extend(this.options,t),OpenLayers.Util.extend(this,t),"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var i=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var e in t)if(t.hasOwnProperty(e)&&OpenLayers.Util.indexOf(i,e)>=0){this.initResolutions();break}}},onMapResize:function(){},redraw:function(){var t=!1;if(this.map){this.inRange=this.calculateInRange();var i=this.getExtent();if(i&&this.inRange&&this.visibility){this.moveTo(i,true,!1),this.events.triggerEvent("moveend",{zoomChanged:true}),t=!0}}return t},moveTo:function(t,i,e){var s=this.visibility;this.isBaseLayer||(s=s&&this.inRange),this.display(s)},setMap:function(t){if(null==this.map){if(this.map=t,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var i=this.visibility&&this.inRange;this.div.style.display=i?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(t){},getImageSize:function(t){return this.imageSize||this.tileSize},setTileSize:function(t){var i=t||(this.tileSize?this.tileSize:this.map.getTileSize());this.tileSize=i,this.gutter&&(this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter),this.imageSize=new OpenLayers.Size(i.w+2*this.gutter,i.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(t){t!=this.visibility&&(this.visibility=t,this.display(t),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(t){t!=("none"!=this.div.style.display)&&(this.div.style.display=t&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var t=!1;if(this.alwaysInRange)t=!0;else if(this.map){var i=this.map.getResolution();t=i>=this.minResolution&&i<=this.maxResolution}return t},setIsBaseLayer:function(t){t!=this.isBaseLayer&&(this.isBaseLayer=t,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var t,i,e,s,n={},o=!0;for(t=0,i=this.RESOLUTION_PROPERTIES.length;t<i;t++){n[l=this.RESOLUTION_PROPERTIES[t]]=this.options[l],o&&this.options[l]&&(o=!1)}if(null==this.alwaysInRange&&(this.alwaysInRange=o),null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n)),null==n.resolutions){for(t=0,i=this.RESOLUTION_PROPERTIES.length;t<i;t++){var l;n[l=this.RESOLUTION_PROPERTIES[t]]=null!=this.options[l]?this.options[l]:this.map[l]}null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n))}if(this.options.maxResolution&&"auto"!==this.options.maxResolution&&(e=this.options.maxResolution),this.options.minScale&&(e=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units)),this.options.minResolution&&"auto"!==this.options.minResolution&&(s=this.options.minResolution),this.options.maxScale&&(s=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),n.resolutions&&(n.resolutions.sort((function(t,i){return i-t})),e||(e=n.resolutions[0]),!s)){var a=n.resolutions.length-1;s=n.resolutions[a]}if(this.resolutions=n.resolutions,this.resolutions){for(i=this.resolutions.length,this.scales=new Array(i),t=0;t<i;t++)this.scales[t]=OpenLayers.Util.getScaleFromResolution(this.resolutions[t],this.units);this.numZoomLevels=i}this.minResolution=s,s&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(s,this.units)),this.maxResolution=e,e&&(this.minScale=OpenLayers.Util.getScaleFromResolution(e,this.units))},resolutionsFromScales:function(t){if(null!=t){var i,e,s;for(s=t.length,i=new Array(s),e=0;e<s;e++)i[e]=OpenLayers.Util.getResolutionFromScale(t[e],this.units);return i}},calculateResolutions:function(t){var i=t.maxResolution;if(null!=t.minScale)i=OpenLayers.Util.getResolutionFromScale(t.minScale,this.units);else if("auto"==i&&null!=this.maxExtent){var e=this.map.getSize(),s=this.maxExtent.getWidth()/e.w,n=this.maxExtent.getHeight()/e.h;i=Math.max(s,n)}var o=t.minResolution;if(null!=t.maxScale)o=OpenLayers.Util.getResolutionFromScale(t.maxScale,this.units);else if("auto"==t.minResolution&&null!=this.minExtent){e=this.map.getSize(),s=this.minExtent.getWidth()/e.w,n=this.minExtent.getHeight()/e.h;o=Math.max(s,n)}var l=t.maxZoomLevel,a=t.numZoomLevels;if("number"==typeof o&&"number"==typeof i&&void 0===a){var r=i/o;a=Math.floor(Math.log(r)/Math.log(2))+1}else void 0===a&&null!=l&&(a=l+1);if(!("number"!=typeof a||a<=0||"number"!=typeof i&&"number"!=typeof o)){var h,u=new Array(a),m=2;if("number"==typeof o&&"number"==typeof i&&(m=Math.pow(i/o,1/(a-1))),"number"==typeof i)for(h=0;h<a;h++)u[h]=i/Math.pow(m,h);else for(h=0;h<a;h++)u[a-1-h]=o*Math.pow(m,h);return u}},getResolution:function(){var t=this.map.getZoom();return this.getResolutionForZoom(t)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(t,i){var e=this.map.getSize(),s=Math.max(t.getWidth()/e.w,t.getHeight()/e.h);return this.getZoomForResolution(s,i)},getDataExtent:function(){},getResolutionForZoom:function(t){var i;if(t=Math.max(0,Math.min(t,this.resolutions.length-1)),this.map.fractionalZoom){var e=Math.floor(t),s=Math.ceil(t);i=this.resolutions[e]-(t-e)*(this.resolutions[e]-this.resolutions[s])}else i=this.resolutions[Math.round(t)];return i},getZoomForResolution:function(t,i){var e;if(this.map.fractionalZoom){for(var s,n=0,o=this.resolutions.length-1,l=this.resolutions[n],a=this.resolutions[o],r=0,h=this.resolutions.length;r<h;++r)if((s=this.resolutions[r])>=t&&(l=s,n=r),s<=t){a=s,o=r;break}var u=l-a;e=u>0?n+(l-t)/u:n}else{var m,p=Number.POSITIVE_INFINITY;for(r=0,h=this.resolutions.length;r<h;r++)if(i){if((m=Math.abs(this.resolutions[r]-t))>p)break;p=m}else if(this.resolutions[r]<t)break;e=Math.max(0,r-1)}return e},getLonLatFromViewPortPx:function(t){var i=null;if(null!=t){var e=this.map.getSize(),s=this.map.getCenter();if(s){var n=this.map.getResolution(),o=t.x-e.w/2,l=t.y-e.h/2;i=new OpenLayers.LonLat(s.lon+o*n,s.lat-l*n),this.wrapDateLine&&(i=i.wrapDateLine(this.maxExtent))}}return i},getViewPortPxFromLonLat:function(t){var i=null;if(null!=t){var e=this.map.getResolution(),s=this.map.getExtent();i=new OpenLayers.Pixel(1/e*(t.lon-s.left),1/e*(s.top-t.lat))}return i},setOpacity:function(t){if(t!=this.opacity){this.opacity=t;for(var i=0,e=this.div.childNodes.length;i<e;++i){var s=this.div.childNodes[i].firstChild;OpenLayers.Util.modifyDOMElement(s,null,null,null,null,null,null,t)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(t){this.div.style.zIndex=t},adjustBounds:function(t){if(this.gutter){var i=this.gutter*this.map.getResolution();t=new OpenLayers.Bounds(t.left-i,t.bottom-i,t.right+i,t.top+i)}if(this.wrapDateLine){var e={rightTolerance:this.getResolution()};t=t.wrapDateLine(this.maxExtent,e)}return t},CLASS_NAME:"OpenLayers.Layer"});