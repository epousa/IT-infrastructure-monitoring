OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(e){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments)},removeComponent:function(e){this.components&&this.components.length>2&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments)},intersects:function(e){var t=!1,n=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==n||"OpenLayers.Geometry.LinearRing"==n||"OpenLayers.Geometry.Point"==n){var s,i,r,o,y,a,p,c,l,h=this.getSortedSegments();s="OpenLayers.Geometry.Point"==n?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();e:for(var x=0,m=h.length;x<m;++x){r=(i=h[x]).x1,o=i.x2,y=i.y1,a=i.y2;for(var g=0,u=s.length;g<u&&!((p=s[g]).x1>o);++g)if(!(p.x2<r)&&(c=p.y1,l=p.y2,!(Math.min(c,l)>Math.max(y,a))&&!(Math.max(c,l)<Math.min(y,a))&&OpenLayers.Geometry.segmentsIntersect(i,p))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){for(var e,t,n=this.components.length-1,s=new Array(n),i=0;i<n;++i)e=this.components[i],t=this.components[i+1],e.x<t.x?s[i]={x1:e.x,y1:e.y,x2:t.x,y2:t.y}:s[i]={x1:t.x,y1:t.y,x2:e.x,y2:e.y};return s.sort((function(e,t){return e.x1-t.x1}))},splitWithSegment:function(e,t){for(var n,s,i,r,o=!(t&&!1===t.edge),y=t&&t.tolerance,a=[],p=this.getVertices(),c=[],l=[],h=!1,x={point:!0,tolerance:y},m=null,g=0,u=p.length-2;g<=u;++g)if(n=p[g],c.push(n.clone()),s=p[g+1],r={x1:n.x,y1:n.y,x2:s.x,y2:s.y},(i=OpenLayers.Geometry.segmentsIntersect(e,r,x))instanceof OpenLayers.Geometry.Point&&(!!(i.x===e.x1&&i.y===e.y1||i.x===e.x2&&i.y===e.y2||i.equals(n)||i.equals(s))||o)){if(i.equals(l[l.length-1])||l.push(i.clone()),0===g&&i.equals(n))continue;if(i.equals(s))continue;h=!0,i.equals(n)||c.push(i),a.push(new OpenLayers.Geometry.LineString(c)),c=[i.clone()]}if(h&&(c.push(s.clone()),a.push(new OpenLayers.Geometry.LineString(c))),l.length>0){var f=e.x1<e.x2?1:-1,L=e.y1<e.y2?1:-1;m={lines:a,points:l.sort((function(e,t){return f*e.x-f*t.x||L*e.y-L*t.y}))}}return m},split:function(e,t){var n,s,i,r,o=null,y=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var a,p,c,l,h,x,m=this.getVertices(),g=[];i=[];for(var u=0,f=m.length-2;u<=f;++u){a=m[u],p=m[u+1],c={x1:a.x,y1:a.y,x2:p.x,y2:p.y},r=r||[e],y&&g.push(a.clone());for(var L=0;L<r.length;++L)if((l=r[L].splitWithSegment(c,t))&&((h=l.lines).length>0&&(h.unshift(L,1),Array.prototype.splice.apply(r,h),L+=h.length-2),y))for(var S=0,d=l.points.length;S<d;++S)(x=l.points[S]).equals(a)||(g.push(x),i.push(new OpenLayers.Geometry.LineString(g)),g=x.equals(p)?[]:[x.clone()])}y&&i.length>0&&g.length>0&&(g.push(p.clone()),i.push(new OpenLayers.Geometry.LineString(g)))}else o=e.splitWith(this,t);return r&&r.length>1?s=!0:r=[],i&&i.length>1?n=!0:i=[],(s||n)&&(o=y?[i,r]:r),o},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){return!0===e?[this.components[0],this.components[this.components.length-1]]:!1===e?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var n,s=!(t&&!1===t.edge)&&t&&t.details,i={},r=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var o,y=this.getSortedSegments(),a=e.x,p=e.y,c=0,l=y.length;c<l;++c)if(o=y[c],(n=OpenLayers.Geometry.distanceToSegment(e,o)).distance<r){if(i=n,0===(r=n.distance))break}else if(o.x2>a&&(p>o.y1&&p<o.y2||p<o.y1&&p>o.y2))break;i=s?{distance:i.distance,x0:i.x,y0:i.y,x1:a,y1:p}:i.distance}else if(e instanceof OpenLayers.Geometry.LineString){var h,x,m,g,u,f=this.getSortedSegments(),L=e.getSortedSegments(),S=L.length,d={point:!0};e:for(c=0,l=f.length;c<l;++c){g=(h=f[c]).x1,u=h.y1;for(var O=0;O<S;++O){if(x=L[O],m=OpenLayers.Geometry.segmentsIntersect(h,x,d)){r=0,i={distance:0,x0:m.x,y0:m.y,x1:m.x,y1:m.y};break e}(n=OpenLayers.Geometry.distanceToSegment({x:g,y:u},x)).distance<r&&(i={distance:r=n.distance,x0:g,y0:u,x1:n.x,y1:n.y})}}if(s||(i=i.distance),0!==r&&h){n=e.distanceTo(new OpenLayers.Geometry.Point(h.x2,h.y2),t);var G=s?n.distance:n;G<r&&(i=s?{distance:r,x0:n.x1,y0:n.y1,x1:n.x0,y1:n.y0}:G)}}else i=e.distanceTo(this,t),s&&(i={distance:i.distance,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0});return i},CLASS_NAME:"OpenLayers.Geometry.LineString"});