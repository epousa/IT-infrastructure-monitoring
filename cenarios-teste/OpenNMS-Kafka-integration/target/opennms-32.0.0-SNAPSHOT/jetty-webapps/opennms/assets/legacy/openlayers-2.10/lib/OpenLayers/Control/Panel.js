OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,activeState:null,initialize:function(t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.controls=[],this.activeState={}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var t=this.controls.length-1;t>=0;t--)this.controls[t].events&&this.controls[t].events.un({activate:this.redraw,deactivate:this.redraw,scope:this}),OpenLayers.Event.stopObservingElement(this.controls[t].panel_div),this.controls[t].panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var t,e=0,n=this.controls.length;e<n;e++)((t=this.controls[e])===this.defaultControl||this.saveState&&this.activeState[t.id])&&t.activate();return!0===this.saveState&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var t,e=0,n=this.controls.length;e<n;e++)t=this.controls[e],this.activeState[t.id]=t.deactivate();return!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.addControlsToMap(this.controls),this.div},redraw:function(){if(this.div.children.length>0)for(var t=this.div.children.length-1;t>=0;t--)this.div.removeChild(this.div.children[t]);if(this.div.innerHTML="",this.active){t=0;for(var e=this.controls.length;t<e;t++){var n=this.controls[t].panel_div;this.controls[t].active?n.className=this.controls[t].displayClass+"ItemActive":n.className=this.controls[t].displayClass+"ItemInactive",this.div.appendChild(n)}}},activateControl:function(t){if(!this.active)return!1;if(t.type==OpenLayers.Control.TYPE_BUTTON)return t.trigger(),void this.redraw();if(t.type==OpenLayers.Control.TYPE_TOGGLE)return t.active?t.deactivate():t.activate(),void this.redraw();for(var e,n=0,i=this.controls.length;n<i;n++)(e=this.controls[n])==t||e.type!==OpenLayers.Control.TYPE_TOOL&&null!=e.type||e.deactivate();t.activate()},addControls:function(t){t instanceof Array||(t=[t]),this.controls=this.controls.concat(t);for(var e=0,n=t.length;e<n;e++){var i=document.createElement("div");t[e].panel_div=i,""!=t[e].title&&(t[e].panel_div.title=t[e].title),OpenLayers.Event.observe(t[e].panel_div,"click",OpenLayers.Function.bind(this.onClick,this,t[e])),OpenLayers.Event.observe(t[e].panel_div,"dblclick",OpenLayers.Function.bind(this.onDoubleClick,this,t[e])),OpenLayers.Event.observe(t[e].panel_div,"mousedown",OpenLayers.Function.bindAsEventListener(OpenLayers.Event.stop))}this.map&&(this.addControlsToMap(t),this.redraw())},addControlsToMap:function(t){for(var e,n=0,i=t.length;n<i;n++)!0===(e=t[n]).autoActivate?(e.autoActivate=!1,this.map.addControl(e),e.autoActivate=!0):(this.map.addControl(e),e.deactivate()),e.events.on({activate:this.redraw,deactivate:this.redraw,scope:this})},onClick:function(t,e){OpenLayers.Event.stop(e||window.event),this.activateControl(t)},onDoubleClick:function(t,e){OpenLayers.Event.stop(e||window.event)},getControlsBy:function(t,e){var n="function"==typeof e.test;return OpenLayers.Array.filter(this.controls,(function(i){return i[t]==e||n&&e.test(i[t])}))},getControlsByName:function(t){return this.getControlsBy("name",t)},getControlsByClass:function(t){return this.getControlsBy("CLASS_NAME",t)},CLASS_NAME:"OpenLayers.Control.Panel"});