OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},createGeometryFromItem:function(e){var t=this.getElementsByTagNameNS(e,this.georssns,"point"),r=this.getElementsByTagNameNS(e,this.geons,"lat"),s=this.getElementsByTagNameNS(e,this.geons,"long"),i=this.getElementsByTagNameNS(e,this.georssns,"line"),n=this.getElementsByTagNameNS(e,this.georssns,"polygon"),a=this.getElementsByTagNameNS(e,this.georssns,"where"),o=this.getElementsByTagNameNS(e,this.georssns,"box");if(t.length>0||r.length>0&&s.length>0){var l;t.length>0?2!=(l=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s+/)).length&&(l=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s*,\s*/)):l=[parseFloat(r[0].firstChild.nodeValue),parseFloat(s[0].firstChild.nodeValue)];var h=new OpenLayers.Geometry.Point(parseFloat(l[1]),parseFloat(l[0]))}else if(i.length>0){for(var p=[],g=0,m=(d=OpenLayers.String.trim(this.concatChildValues(i[0])).split(/\s+/)).length;g<m;g+=2)t=new OpenLayers.Geometry.Point(parseFloat(d[g+1]),parseFloat(d[g])),p.push(t);h=new OpenLayers.Geometry.LineString(p)}else if(n.length>0){for(p=[],g=0,m=(d=OpenLayers.String.trim(this.concatChildValues(n[0])).split(/\s+/)).length;g<m;g+=2)t=new OpenLayers.Geometry.Point(parseFloat(d[g+1]),parseFloat(d[g])),p.push(t);h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(p)])}else if(a.length>0){this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})),h=this.gmlParser.parseFeature(a[0]).geometry}else if(o.length>0){var d;p=[];(d=OpenLayers.String.trim(o[0].firstChild.nodeValue).split(/\s+/)).length>3&&(t=new OpenLayers.Geometry.Point(parseFloat(d[1]),parseFloat(d[0])),p.push(t),t=new OpenLayers.Geometry.Point(parseFloat(d[1]),parseFloat(d[2])),p.push(t),t=new OpenLayers.Geometry.Point(parseFloat(d[3]),parseFloat(d[2])),p.push(t),t=new OpenLayers.Geometry.Point(parseFloat(d[3]),parseFloat(d[0])),p.push(t),t=new OpenLayers.Geometry.Point(parseFloat(d[1]),parseFloat(d[0])),p.push(t)),h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(p)])}return h&&this.internalProjection&&this.externalProjection&&h.transform(this.externalProjection,this.internalProjection),h},createFeatureFromItem:function(e){var t=this.createGeometryFromItem(e),r=this.getChildValue(e,"*","title",this.featureTitle),s=this.getChildValue(e,"*","description",this.getChildValue(e,"*","content",this.getChildValue(e,"*","summary",this.featureDescription))),i=this.getChildValue(e,"*","link");if(!i)try{i=this.getElementsByTagNameNS(e,"*","link")[0].getAttribute("href")}catch(e){i=null}var n=this.getChildValue(e,"*","id",null),a={title:r,description:s,link:i},o=new OpenLayers.Feature.Vector(t,a);return o.fid=n,o},getChildValue:function(e,t,r,s){var i=this.getElementsByTagNameNS(e,t,r);return i&&i[0]&&i[0].firstChild&&i[0].firstChild.nodeValue?i[0].firstChild.nodeValue:null==s?"":s},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=null;0==(t=this.getElementsByTagNameNS(e,"*","item")).length&&(t=this.getElementsByTagNameNS(e,"*","entry"));for(var r=t.length,s=new Array(r),i=0;i<r;i++)s[i]=this.createFeatureFromItem(t[i]);return s},write:function(e){var t;if(e instanceof Array){t=this.createElementNS(this.rssns,"rss");for(var r=0,s=e.length;r<s;r++)t.appendChild(this.createFeatureXML(e[r]))}else t=this.createFeatureXML(e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=this.buildGeometryNode(e.geometry),r=this.createElementNS(this.rssns,"item"),s=this.createElementNS(this.rssns,"title");s.appendChild(this.createTextNode(e.attributes.title?e.attributes.title:""));var i=this.createElementNS(this.rssns,"description");if(i.appendChild(this.createTextNode(e.attributes.description?e.attributes.description:"")),r.appendChild(s),r.appendChild(i),e.attributes.link){var n=this.createElementNS(this.rssns,"link");n.appendChild(this.createTextNode(e.attributes.link)),r.appendChild(n)}for(var a in e.attributes)if("link"!=a&&"title"!=a&&"description"!=a){var o=this.createTextNode(e.attributes[a]),l=a;-1!=a.search(":")&&(l=a.split(":")[1]);var h=this.createElementNS(this.featureNS,"feature:"+l);h.appendChild(o),r.appendChild(h)}return r.appendChild(t),r},buildGeometryNode:function(e){var t;if(this.internalProjection&&this.externalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection),"OpenLayers.Geometry.Polygon"==e.CLASS_NAME)(t=this.createElementNS(this.georssns,"georss:polygon")).appendChild(this.buildCoordinatesNode(e.components[0]));else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)(t=this.createElementNS(this.georssns,"georss:line")).appendChild(this.buildCoordinatesNode(e));else{if("OpenLayers.Geometry.Point"!=e.CLASS_NAME)throw"Couldn't parse "+e.CLASS_NAME;(t=this.createElementNS(this.georssns,"georss:point")).appendChild(this.buildCoordinatesNode(e))}return t},buildCoordinatesNode:function(e){var t,r=null;if(e.components&&(r=e.components),r){for(var s=r.length,i=new Array(s),n=0;n<s;n++)i[n]=r[n].y+" "+r[n].x;t=i.join(" ")}else t=e.y+" "+e.x;return this.createTextNode(t)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});