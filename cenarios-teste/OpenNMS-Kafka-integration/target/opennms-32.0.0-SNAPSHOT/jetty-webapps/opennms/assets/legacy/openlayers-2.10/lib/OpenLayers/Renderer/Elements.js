OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.order=[],this.indices={},this.maxZIndex=0},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var r,n=-1,i=this.order.length;i-n>1;){r=parseInt((n+i)/2),this.compare(this,e,OpenLayers.Util.getElement(this.order[r]))>0?n=r:i=r}return this.order.splice(i,0,t),this.indices[t]=this.getZIndex(e),this.getNextElement(i)},remove:function(e){var t=e.id,r=OpenLayers.Util.indexOf(this.order,t);if(r>=0)if(this.order.splice(r,1),delete this.indices[t],this.order.length>0){var n=this.order[this.order.length-1];this.maxZIndex=this.indices[n]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;null==t?(t=this.maxZIndex,e._style.graphicZIndex=t):t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){var t=e+1;if(t<this.order.length){var r=OpenLayers.Util.getElement(this.order[t]);return null==r&&(r=this.getNextElement(t)),r}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,r){var n=e.getZIndex(t),i=0;r&&(i=n-e.getZIndex(r));return i},Z_ORDER_DRAWING_ORDER:function(e,t,r){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,r);return r&&0==n&&(n=1),n},Z_ORDER_Y_ORDER:function(e,t,r){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,r);if(r&&0===n){var i=r._boundsBottom-t._boundsBottom;n=0===i?1:i}return n}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},getNodeType:function(e,t){},drawGeometry:function(e,t,r){var n=e.CLASS_NAME,i=!0;if("OpenLayers.Geometry.Collection"==n||"OpenLayers.Geometry.MultiPoint"==n||"OpenLayers.Geometry.MultiLineString"==n||"OpenLayers.Geometry.MultiPolygon"==n){for(var o=0,s=e.components.length;o<s;o++)i=this.drawGeometry(e.components[o],t,r)&&i;return i}if(i=!1,"none"!=t.display&&(t.backgroundGraphic&&this.redrawBackgroundNode(e.id,e,t,r),i=this.redrawNode(e.id,e,t,r)),0==i){var d=document.getElementById(e.id);d&&(d._style.backgroundGraphic&&d.parentNode.removeChild(document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX)),d.parentNode.removeChild(d))}return i},redrawNode:function(e,t,r,n){r=this.applyDefaultSymbolizer(r);var i=this.nodeFactory(e,this.getNodeType(t,r));i._featureId=n,i._boundsBottom=t.getBounds().bottom,i._geometryClass=t.CLASS_NAME,i._style=r;var o=this.drawGeometryNode(i,t,r);if(!1===o)return!1;if(i=o.node,this.indexer){var s=this.indexer.insert(i);s?this.vectorRoot.insertBefore(i,s):this.vectorRoot.appendChild(i)}else i.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(i);return this.postDraw(i),o.complete},redrawBackgroundNode:function(e,t,r,n){var i=OpenLayers.Util.extend({},r);return i.externalGraphic=i.backgroundGraphic,i.graphicXOffset=i.backgroundXOffset,i.graphicYOffset=i.backgroundYOffset,i.graphicZIndex=i.backgroundGraphicZIndex,i.graphicWidth=i.backgroundWidth||i.graphicWidth,i.graphicHeight=i.backgroundHeight||i.graphicHeight,i.backgroundGraphic=null,i.backgroundXOffset=null,i.backgroundYOffset=null,i.backgroundGraphicZIndex=null,this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,i,null)},drawGeometryNode:function(e,t,r){var n,i={isFilled:void 0===(r=r||e._style).fill||r.fill,isStroked:void 0===r.stroke?!!r.strokeWidth:r.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":!1===r.graphic&&(i.isFilled=!1,i.isStroked=!1),n=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":i.isFilled=!1,n=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":n=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":n=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Surface":n=this.drawSurface(e,t);break;case"OpenLayers.Geometry.Rectangle":n=this.drawRectangle(e,t)}return e._options=i,0!=n&&{node:this.setStyle(e,r,i,t),complete:n}},postDraw:function(e){},drawPoint:function(e,t){},drawLineString:function(e,t){},drawLinearRing:function(e,t){},drawPolygon:function(e,t){},drawRectangle:function(e,t){},drawCircle:function(e,t){},drawSurface:function(e,t){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t)},getFeatureIdFromEvent:function(e){var t=e.target,r=t&&t.correspondingUseElement;return(r||(t||e.srcElement))._featureId},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var r=0,n=e.components.length;r<n;r++)this.eraseGeometry(e.components[r],t);else{var i=OpenLayers.Util.getElement(e.id);if(i&&i.parentNode&&(i.geometry&&(i.geometry.destroy(),i.geometry=null),i.parentNode.removeChild(i),this.indexer&&this.indexer.remove(i),i._style.backgroundGraphic)){var o=e.id+this.BACKGROUND_ID_SUFFIX,s=OpenLayers.Util.getElement(o);s&&s.parentNode&&s.parentNode.removeChild(s)}}},nodeFactory:function(e,t){var r=OpenLayers.Util.getElement(e);return r?this.nodeTypeCompare(r,t)||(r.parentNode.removeChild(r),r=this.nodeFactory(e,t)):r=this.createNode(t,e),r},nodeTypeCompare:function(e,t){},createNode:function(e,t){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root),t.parentNode.removeChild(t),e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};