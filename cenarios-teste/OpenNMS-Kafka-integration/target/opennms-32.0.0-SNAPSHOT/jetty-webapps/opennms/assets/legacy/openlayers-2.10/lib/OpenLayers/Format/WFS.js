OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(e,t){OpenLayers.Format.GML.prototype.initialize.apply(this,[e]),this.layer=t,this.layer.featureNS&&(this.featureNS=this.layer.featureNS),this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column),this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(e){var t=this.createElementNS(this.wfsns,"wfs:Transaction");t.setAttribute("version","1.0.0"),t.setAttribute("service","WFS");for(var r=0;r<e.length;r++)switch(e[r].state){case OpenLayers.State.INSERT:t.appendChild(this.insert(e[r]));break;case OpenLayers.State.UPDATE:t.appendChild(this.update(e[r]));break;case OpenLayers.State.DELETE:t.appendChild(this.remove(e[r]))}return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=this.buildGeometryNode(e.geometry),r=this.createElementNS(this.featureNS,"feature:"+this.geometryName);r.appendChild(t);var s=this.createElementNS(this.featureNS,"feature:"+this.featureName);for(var i in s.appendChild(r),e.attributes){var a=this.createTextNode(e.attributes[i]),n=i;-1!=i.search(":")&&(n=i.split(":")[1]);var h=this.createElementNS(this.featureNS,"feature:"+n);h.appendChild(a),s.appendChild(h)}return s},insert:function(e){var t=this.createElementNS(this.wfsns,"wfs:Insert");return t.appendChild(this.createFeatureXML(e)),t},update:function(e){e.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var t=this.createElementNS(this.wfsns,"wfs:Update");t.setAttribute("typeName",this.featurePrefix+":"+this.featureName),t.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var r=this.createElementNS(this.wfsns,"wfs:Property"),s=this.createElementNS(this.wfsns,"wfs:Name"),i=this.createTextNode(this.geometryName);s.appendChild(i),r.appendChild(s);var a=this.createElementNS(this.wfsns,"wfs:Value"),n=this.buildGeometryNode(e.geometry);for(var h in e.layer&&n.setAttribute("srsName",e.layer.projection.getCode()),a.appendChild(n),r.appendChild(a),t.appendChild(r),e.attributes)r=this.createElementNS(this.wfsns,"wfs:Property"),(s=this.createElementNS(this.wfsns,"wfs:Name")).appendChild(this.createTextNode(h)),r.appendChild(s),(a=this.createElementNS(this.wfsns,"wfs:Value")).appendChild(this.createTextNode(e.attributes[h])),r.appendChild(a),t.appendChild(r);var p=this.createElementNS(this.ogcns,"ogc:Filter"),l=this.createElementNS(this.ogcns,"ogc:FeatureId");return l.setAttribute("fid",e.fid),p.appendChild(l),t.appendChild(p),t},remove:function(e){if(!e.fid)return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1;var t=this.createElementNS(this.wfsns,"wfs:Delete");t.setAttribute("typeName",this.featurePrefix+":"+this.featureName),t.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var r=this.createElementNS(this.ogcns,"ogc:Filter"),s=this.createElementNS(this.ogcns,"ogc:FeatureId");return s.setAttribute("fid",e.fid),r.appendChild(s),t.appendChild(r),t},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"});