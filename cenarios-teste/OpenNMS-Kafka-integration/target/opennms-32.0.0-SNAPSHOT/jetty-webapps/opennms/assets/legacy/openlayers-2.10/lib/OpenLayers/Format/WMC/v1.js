OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(e){var t=null;if(null==e)t=this.namespaces[this.defaultPrefix];else for(t in this.namespaces)if(this.namespaces[t]==e)break;return t},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e.documentElement;this.rootPrefix=t.prefix;var i={version:t.getAttribute("version")};return this.runChildNodes(i,t),i},runChildNodes:function(e,t){for(var i,n,r=t.childNodes,a=0,s=r.length;a<s;++a)1==(i=r[a]).nodeType&&(n=this["read_"+this.getNamespacePrefix(i.namespaceURI)+"_"+i.nodeName.split(":").pop()])&&n.apply(this,[e,i])},read_wmc_General:function(e,t){this.runChildNodes(e,t)},read_wmc_BoundingBox:function(e,t){e.projection=t.getAttribute("SRS"),e.bounds=new OpenLayers.Bounds(parseFloat(t.getAttribute("minx")),parseFloat(t.getAttribute("miny")),parseFloat(t.getAttribute("maxx")),parseFloat(t.getAttribute("maxy")))},read_wmc_LayerList:function(e,t){e.layersContext=[],this.runChildNodes(e,t)},read_wmc_Layer:function(e,t){var i={visibility:"1"!=t.getAttribute("hidden"),queryable:"1"==t.getAttribute("queryable"),formats:[],styles:[]};this.runChildNodes(i,t),e.layersContext.push(i)},read_wmc_Extension:function(e,t){this.runChildNodes(e,t)},read_ol_units:function(e,t){e.units=this.getChildValue(t)},read_ol_maxExtent:function(e,t){var i=new OpenLayers.Bounds(t.getAttribute("minx"),t.getAttribute("miny"),t.getAttribute("maxx"),t.getAttribute("maxy"));e.maxExtent=i},read_ol_transparent:function(e,t){e.transparent=this.getChildValue(t)},read_ol_numZoomLevels:function(e,t){e.numZoomLevels=parseInt(this.getChildValue(t))},read_ol_opacity:function(e,t){e.opacity=parseFloat(this.getChildValue(t))},read_ol_singleTile:function(e,t){e.singleTile="true"==this.getChildValue(t)},read_ol_tileSize:function(e,t){var i={width:t.getAttribute("width"),height:t.getAttribute("height")};e.tileSize=i},read_ol_isBaseLayer:function(e,t){e.isBaseLayer="true"==this.getChildValue(t)},read_ol_displayInLayerSwitcher:function(e,t){e.displayInLayerSwitcher="true"==this.getChildValue(t)},read_wmc_Server:function(e,t){e.version=t.getAttribute("version");var i={},n=t.getElementsByTagName("OnlineResource");n.length>0&&this.read_wmc_OnlineResource(i,n[0]),e.url=i.href},read_wmc_FormatList:function(e,t){this.runChildNodes(e,t)},read_wmc_Format:function(e,t){var i={value:this.getChildValue(t)};"1"==t.getAttribute("current")&&(i.current=!0),e.formats.push(i)},read_wmc_StyleList:function(e,t){this.runChildNodes(e,t)},read_wmc_Style:function(e,t){var i={};this.runChildNodes(i,t),"1"==t.getAttribute("current")&&(i.current=!0),e.styles.push(i)},read_wmc_SLD:function(e,t){this.runChildNodes(e,t)},read_sld_StyledLayerDescriptor:function(e,t){var i=OpenLayers.Format.XML.prototype.write.apply(this,[t]);e.body=i},read_wmc_OnlineResource:function(e,t){e.href=this.getAttributeNS(t,this.namespaces.xlink,"href")},read_wmc_Name:function(e,t){var i=this.getChildValue(t);i&&(e.name=i)},read_wmc_Title:function(e,t){var i=this.getChildValue(t);i&&(e.title=i)},read_wmc_MetadataURL:function(e,t){var i={},n=t.getElementsByTagName("OnlineResource");n.length>0&&this.read_wmc_OnlineResource(i,n[0]),e.metadataURL=i.href},read_wmc_Abstract:function(e,t){var i=this.getChildValue(t);i&&(e.abstract=i)},read_wmc_LegendURL:function(e,t){var i={width:t.getAttribute("width"),height:t.getAttribute("height")},n=t.getElementsByTagName("OnlineResource");n.length>0&&this.read_wmc_OnlineResource(i,n[0]),e.legend=i},write:function(e,t){var i=this.createElementDefaultNS("ViewContext");return this.setAttributes(i,{version:this.VERSION,id:t&&"string"==typeof t.id?t.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")}),this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),i.appendChild(this.write_wmc_General(e)),i.appendChild(this.write_wmc_LayerList(e)),OpenLayers.Format.XML.prototype.write.apply(this,[i])},createElementDefaultNS:function(e,t,i){var n=this.createElementNS(this.namespaces[this.defaultPrefix],e);return t&&n.appendChild(this.createTextNode(t)),i&&this.setAttributes(n,i),n},setAttributes:function(e,t){var i;for(var n in t)(i=t[n].toString()).match(/[A-Z]/)?this.setAttributeNS(e,null,n,i):e.setAttribute(n,i)},write_wmc_General:function(e){var t=this.createElementDefaultNS("General");e.size&&t.appendChild(this.createElementDefaultNS("Window",null,{width:e.size.w,height:e.size.h}));var i=e.bounds;return t.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18),SRS:e.projection})),t.appendChild(this.createElementDefaultNS("Title",e.title)),t.appendChild(this.write_ol_MapExtension(e)),t},write_ol_MapExtension:function(e){var t=this.createElementDefaultNS("Extension"),i=e.maxExtent;if(i){var n=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(n,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18)}),t.appendChild(n)}return t},write_wmc_LayerList:function(e){for(var t=this.createElementDefaultNS("LayerList"),i=0,n=e.layersContext.length;i<n;++i)t.appendChild(this.write_wmc_Layer(e.layersContext[i]));return t},write_wmc_Layer:function(e){var t=this.createElementDefaultNS("Layer",null,{queryable:e.queryable?"1":"0",hidden:e.visibility?"0":"1"});return t.appendChild(this.write_wmc_Server(e)),t.appendChild(this.createElementDefaultNS("Name",e.name)),t.appendChild(this.createElementDefaultNS("Title",e.title)),e.metadataURL&&t.appendChild(this.write_wmc_MetadataURL(e.metadataURL)),t},write_wmc_LayerExtension:function(e){var t=this.createElementDefaultNS("Extension"),i=e.maxExtent,n=this.createElementNS(this.namespaces.ol,"ol:maxExtent");if(this.setAttributes(n,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18)}),t.appendChild(n),e.tileSize&&!e.singleTile){var r=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(r,e.tileSize),t.appendChild(r)}for(var a,s=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"],l=0,o=s.length;l<o;++l)(a=this.createOLPropertyNode(e,s[l]))&&t.appendChild(a);return t},createOLPropertyNode:function(e,t){var i=null;return null!=e[t]&&(i=this.createElementNS(this.namespaces.ol,"ol:"+t)).appendChild(this.createTextNode(e[t].toString())),i},write_wmc_Server:function(e){var t=this.createElementDefaultNS("Server");return this.setAttributes(t,{service:"OGC:WMS",version:e.version}),t.appendChild(this.write_wmc_OnlineResource(e.url)),t},write_wmc_MetadataURL:function(e){var t=this.createElementDefaultNS("MetadataURL");return t.appendChild(this.write_wmc_OnlineResource(e)),t},write_wmc_FormatList:function(e){for(var t=this.createElementDefaultNS("FormatList"),i=0,n=e.formats.length;i<n;i++){var r=e.formats[i];t.appendChild(this.createElementDefaultNS("Format",r.value,r.current&&1==r.current?{current:"1"}:null))}return t},write_wmc_StyleList:function(e){var t=this.createElementDefaultNS("StyleList"),i=e.styles;if(i&&i instanceof Array)for(var n,r=0,a=i.length;r<a;r++){var s=i[r],l=this.createElementDefaultNS("Style",null,s.current&&1==s.current?{current:"1"}:null);if(s.href){n=this.createElementDefaultNS("SLD");var o=this.write_wmc_OnlineResource(s.href);n.appendChild(o),n.appendChild(this.createElementDefaultNS("Name",s.name)),s.title&&n.appendChild(this.createElementDefaultNS("Title",s.title)),l.appendChild(n)}else if(s.body){n=this.createElementDefaultNS("SLD");var u=OpenLayers.Format.XML.prototype.read.apply(this,[s.body]).documentElement;n.ownerDocument&&n.ownerDocument.importNode&&(u=n.ownerDocument.importNode(u,!0)),n.appendChild(u),n.appendChild(this.createElementDefaultNS("Name",s.name)),s.title&&n.appendChild(this.createElementDefaultNS("Title",s.title)),l.appendChild(n)}else l.appendChild(this.createElementDefaultNS("Name",s.name)),l.appendChild(this.createElementDefaultNS("Title",s.title)),s.abstract&&l.appendChild(this.createElementDefaultNS("Abstract",s.abstract));t.appendChild(l)}return t},write_wmc_OnlineResource:function(e){var t=this.createElementDefaultNS("OnlineResource");return this.setAttributeNS(t,this.namespaces.xlink,"xlink:type","simple"),this.setAttributeNS(t,this.namespaces.xlink,"xlink:href",e),t},CLASS_NAME:"OpenLayers.Format.WMC.v1"});