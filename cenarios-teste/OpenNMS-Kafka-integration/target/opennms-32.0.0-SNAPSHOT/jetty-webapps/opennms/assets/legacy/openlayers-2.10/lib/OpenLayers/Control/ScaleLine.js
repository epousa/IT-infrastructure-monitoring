OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,initialize:function(t){OpenLayers.Control.prototype.initialize.apply(this,[t])},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.eTop){this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top";this.topInUnits.length;this.div.appendChild(this.eTop),""==this.topOutUnits||""==this.topInUnits?this.eTop.style.visibility="hidden":this.eTop.style.visibility="visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),""==this.bottomOutUnits||""==this.bottomInUnits?this.eBottom.style.visibility="hidden":this.eBottom.style.visibility="visible"}return this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(t){var i=parseInt(Math.log(t)/Math.log(10)),e=Math.pow(10,i),s=parseInt(t/e);return(s>5?5:s>2?2:1)*e},update:function(){var t=this.map.getResolution();if(t){var i,e,s=this.map.getUnits(),o=OpenLayers.INCHES_PER_UNIT,n=this.maxWidth*t*o[s],h=1;if(!0===this.geodesic)n*=h=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth/(n/o.km);n>1e5?(i=this.topOutUnits,e=this.bottomOutUnits):(i=this.topInUnits,e=this.bottomInUnits);var a=n/o[i],p=n/o[e],l=this.getBarLen(a),r=this.getBarLen(p),m=(a=l/o[s]*o[i])/t/h,d=(p=r/o[s]*o[e])/t/h;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(d)+"px",this.eBottom.innerHTML=r+" "+e),"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(m)+"px",this.eTop.innerHTML=l+" "+i)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});