OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(e,t,r,a){var i=[];i.push(e,t,r,a),OpenLayers.Layer.Grid.prototype.initialize.apply(this,i),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS),null!=a&&null!=a.isBaseLayer||(this.isBaseLayer="true"!=this.params.transparent&&1!=this.params.transparent)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},addTile:function(e,t){return new OpenLayers.Tile.Image(this,t,e,null,this.tileSize)},getURL:function(e){var t=[(e=this.adjustBounds(e)).left,e.bottom,e.right,e.top],r=this.getImageSize();return this.getFullRequestString({mapext:t,imgext:t,map_size:[r.w,r.h],imgx:r.w/2,imgy:r.h/2,imgxy:[r.w,r.h]})},getFullRequestString:function(e,t){var r=null==t?this.url:t,a=OpenLayers.Util.extend({},this.params);a=OpenLayers.Util.extend(a,e);var i=OpenLayers.Util.getParameterString(a);r instanceof Array&&(r=this.selectUrl(i,r));var s=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(r));for(var n in a)n.toUpperCase()in s&&delete a[n];var p=r;if(""!=(i=(i=OpenLayers.Util.getParameterString(a)).replace(/,/g,"+"))){var l=r.charAt(r.length-1);"&"==l||"?"==l?p+=i:-1==r.indexOf("?")?p+="?"+i:p+="&"+i}return p},CLASS_NAME:"OpenLayers.Layer.MapServer"});