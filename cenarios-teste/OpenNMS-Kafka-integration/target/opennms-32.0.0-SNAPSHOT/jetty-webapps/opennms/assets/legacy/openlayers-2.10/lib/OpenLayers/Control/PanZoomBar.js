OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,divEvents:null,zoomWorldIcon:!1,forceFixedZoomLevel:!1,mouseDragStart:null,zoomStart:null,initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments)},destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(t){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(t){OpenLayers.Control.prototype.draw.apply(this,arguments),t=this.position.clone(),this.buttons=[];var o=new OpenLayers.Size(18,18),e=new OpenLayers.Pixel(t.x+o.w/2,t.y),i=o.w;return this.zoomWorldIcon&&(e=new OpenLayers.Pixel(t.x+o.w,t.y)),this._addButton("panup","north-mini.png",e,o),t.y=e.y+o.h,this._addButton("panleft","west-mini.png",t,o),this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",t.add(o.w,0),o),i*=2),this._addButton("panright","east-mini.png",t.add(i,0),o),this._addButton("pandown","south-mini.png",e.add(0,2*o.h),o),this._addButton("zoomin","zoom-plus-mini.png",e.add(0,3*o.h+5),o),e=this._addZoomBar(e.add(0,4*o.h+5)),this._addButton("zoomout","zoom-minus-mini.png",e,o),this.div},_addZoomBar:function(t){var o=OpenLayers.Util.getImagesLocation(),e=this.id+"_"+this.map.id,i=this.map.getNumZoomLevels()-1-this.map.getZoom(),s=OpenLayers.Util.createAlphaImageDiv(e,t.add(-1,i*this.zoomStopHeight),new OpenLayers.Size(20,9),o+"slider.png","absolute");this.slider=s,this.sliderEvents=new OpenLayers.Events(this,s,null,!0,{includeXY:!0}),this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var n=new OpenLayers.Size;n.h=this.zoomStopHeight*this.map.getNumZoomLevels(),n.w=this.zoomStopWidth;var a=null;if(OpenLayers.Util.alphaHack()){e=this.id+"_"+this.map.id;(a=OpenLayers.Util.createAlphaImageDiv(e,t,new OpenLayers.Size(n.w,this.zoomStopHeight),o+"zoombar.png","absolute",null,"crop")).style.height=n.h+"px"}else a=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,t,n,o+"zoombar.png");return this.zoombarDiv=a,this.divEvents=new OpenLayers.Events(this,a,null,!0,{includeXY:!0}),this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick}),this.div.appendChild(a),this.startTop=parseInt(a.style.top),this.div.appendChild(s),this.map.events.register("zoomend",this,this.moveZoomBar),t=t.add(0,this.zoomStopHeight*this.map.getNumZoomLevels())},_removeZoomBar:function(){this.sliderEvents.un({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick}),this.sliderEvents.destroy(),this.divEvents.un({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick}),this.divEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},passEventToSlider:function(t){this.sliderEvents.handleBrowserEvent(t)},divClick:function(t){if(OpenLayers.Event.isLeftClick(t)){var o=(t.xy.y-OpenLayers.Util.pagePosition(t.object)[1])/this.zoomStopHeight;!this.forceFixedZoomLevel&&this.map.fractionalZoom||(o=Math.floor(o));var e=this.map.getNumZoomLevels()-1-o;e=Math.min(Math.max(e,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(e),OpenLayers.Event.stop(t)}},zoomBarDown:function(t){OpenLayers.Event.isLeftClick(t)&&(this.map.events.on({mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=t.xy.clone(),this.zoomStart=t.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(t))},zoomBarDrag:function(t){if(null!=this.mouseDragStart){var o=this.mouseDragStart.y-t.xy.y,e=OpenLayers.Util.pagePosition(this.zoombarDiv);if(t.clientY-e[1]>0&&t.clientY-e[1]<parseInt(this.zoombarDiv.style.height)-2){var i=parseInt(this.slider.style.top)-o;this.slider.style.top=i+"px",this.mouseDragStart=t.xy.clone()}OpenLayers.Event.stop(t)}},zoomBarUp:function(t){if(OpenLayers.Event.isLeftClick(t)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var o=this.zoomStart.y-t.xy.y,e=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(e+=o/this.zoomStopHeight,e=Math.min(Math.max(e,0),this.map.getNumZoomLevels()-1)):e+=Math.round(o/this.zoomStopHeight),this.map.zoomTo(e),this.mouseDragStart=null,this.zoomStart=null,OpenLayers.Event.stop(t)}},moveZoomBar:function(){var t=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=t+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});