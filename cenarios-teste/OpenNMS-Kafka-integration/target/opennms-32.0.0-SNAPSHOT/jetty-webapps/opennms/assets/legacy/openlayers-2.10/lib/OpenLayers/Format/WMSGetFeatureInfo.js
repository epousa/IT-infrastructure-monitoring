OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,arguments),OpenLayers.Util.extend(this,e),this.options=e},read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var r=e.documentElement;if(r){var a=this["read_"+r.nodeName];t=a?a.call(this,r):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],r=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(r)for(var a=0,n=r.length;a<n;++a){var i=r[a],s=i.nodeName;i.prefix&&(s=s.split(":")[1]);s=s.replace(this.layerIdentifier,"");var o=this.getSiblingNodesByTagCriteria(i,this.featureIdentifier);if(o)for(var l=0;l<o.length;l++){var p=o[l],d=this.parseGeometry(p),u=this.parseAttributes(p),h=new OpenLayers.Feature.Vector(d.geometry,u,null);h.bounds=d.bounds,h.type=s,t.push(h)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],r=this.getElementsByTagNameNS(e,"*","FIELDS"),a=0,n=r.length;a<n;a++){for(var i=r[a],s={},o=0,l=i.attributes.length;o<l;o++){var p=i.attributes[o];s[p.nodeName]=p.nodeValue}t.push(new OpenLayers.Feature.Vector(null,s,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var r,a,n,i,s,o=[];if(e&&e.hasChildNodes()){n=(r=e.childNodes).length;for(var l=0;l<n;l++){for(s=r[l];s&&1!=s.nodeType;)s=s.nextSibling,l++;(a=s?s.nodeName:"").length>0&&a.indexOf(t)>-1?o.push(s):(i=this.getSiblingNodesByTagCriteria(s,t)).length>0&&(0==o.length?o=i:o.push(i))}}return o},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var r=e.childNodes,a=r.length,n=0;n<a;++n){var i=r[n];if(1==i.nodeType){var s=i.childNodes;if(1==s.length){var o=s[0];if(3==o.nodeType||4==o.nodeType){var l=i.prefix?i.nodeName.split(":")[1]:i.nodeName,p=o.nodeValue.replace(this.regExes.trimSpace,"");t[l]=p}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,r=this.gmlFormat.parseFeature(e),a=null;return r&&(t=r.geometry&&r.geometry.clone(),a=r.bounds&&r.bounds.clone(),r.destroy()),{geometry:t,bounds:a}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});