OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,drawing:!1,mouseDown:!1,lastDown:null,lastUp:null,persist:!1,layerOptions:null,initialize:function(t,e,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var t=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,t),this.map.addLayer(this.layer),!0},createFeature:function(t){var e=this.map.getLonLatFromPixel(t);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e.lon,e.lat)),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.drawing&&this.cancel(),this.destroyFeature(),null!=this.layer.map&&this.layer.destroy(!1),this.layer=null,!0)},destroyFeature:function(){this.layer&&this.layer.destroyFeatures(),this.point=null},finalize:function(t){var e=t?"cancel":"done";this.drawing=!1,this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.callback(e,[this.geometryClone()]),!t&&this.persist||this.destroyFeature()},cancel:function(){this.finalize(!0)},click:function(t){return OpenLayers.Event.stop(t),!1},dblclick:function(t){return OpenLayers.Event.stop(t),!1},modifyFeature:function(t){var e=this.map.getLonLatFromPixel(t);this.point.geometry.x=e.lon,this.point.geometry.y=e.lat,this.callback("modify",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var t=this.point&&this.point.geometry;return t&&this.multi&&(t=new OpenLayers.Geometry.MultiPoint([t])),t},geometryClone:function(){var t=this.getGeometry();return t&&t.clone()},mousedown:function(t){return!this.checkModifiers(t)||(!(!this.lastDown||!this.lastDown.equals(t.xy))||(this.drawing=!0,null==this.lastDown?(this.persist&&this.destroyFeature(),this.createFeature(t.xy)):this.modifyFeature(t.xy),this.lastDown=t.xy,!1))},mousemove:function(t){return this.drawing&&this.modifyFeature(t.xy),!0},mouseup:function(t){return!this.drawing||(this.finalize(),!1)},CLASS_NAME:"OpenLayers.Handler.Point"});