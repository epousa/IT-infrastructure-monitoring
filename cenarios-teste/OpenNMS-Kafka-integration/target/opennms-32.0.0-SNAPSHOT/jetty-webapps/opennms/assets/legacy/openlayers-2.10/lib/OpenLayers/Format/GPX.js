OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,initialize:function(t){this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[t])},read:function(t){"string"==typeof t&&(t=OpenLayers.Format.XML.prototype.read.apply(this,[t]));var e=[];if(this.extractTracks)for(var r=t.getElementsByTagName("trk"),a=0,n=r.length;a<n;a++){var i={};this.extractAttributes&&(i=this.parseAttributes(r[a]));for(var s=this.getElementsByTagNameNS(r[a],r[a].namespaceURI,"trkseg"),o=0,p=s.length;o<p;o++){var h=this.extractSegment(s[o],"trkpt");e.push(new OpenLayers.Feature.Vector(h,i))}}if(this.extractRoutes)for(var y=t.getElementsByTagName("rte"),m=0,c=y.length;m<c;m++){i={};this.extractAttributes&&(i=this.parseAttributes(y[m]));var l=this.extractSegment(y[m],"rtept");e.push(new OpenLayers.Feature.Vector(l,i))}if(this.extractWaypoints){var g=t.getElementsByTagName("wpt"),u=0;for(n=g.length;u<n;u++){i={};this.extractAttributes&&(i=this.parseAttributes(g[u]));var f=new OpenLayers.Geometry.Point(g[u].getAttribute("lon"),g[u].getAttribute("lat"));e.push(new OpenLayers.Feature.Vector(f,i))}}if(this.internalProjection&&this.externalProjection)for(var x=0,L=e.length;x<L;x++)e[x].geometry.transform(this.externalProjection,this.internalProjection);return e},extractSegment:function(t,e){for(var r=this.getElementsByTagNameNS(t,t.namespaceURI,e),a=[],n=0,i=r.length;n<i;n++)a.push(new OpenLayers.Geometry.Point(r[n].getAttribute("lon"),r[n].getAttribute("lat")));return new OpenLayers.Geometry.LineString(a)},parseAttributes:function(t){for(var e={},r=t.firstChild;r;){if(1==r.nodeType){var a=r.firstChild;3!=a.nodeType&&4!=a.nodeType||(name=r.prefix?r.nodeName.split(":")[1]:r.nodeName,"trkseg"!=name&&"rtept"!=name&&(e[name]=a.nodeValue))}r=r.nextSibling}return e},CLASS_NAME:"OpenLayers.Format.GPX"});