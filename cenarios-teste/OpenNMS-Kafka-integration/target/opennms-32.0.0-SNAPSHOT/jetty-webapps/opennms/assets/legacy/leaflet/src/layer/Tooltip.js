L.Tooltip=L.DivOverlay.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){L.DivOverlay.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){L.DivOverlay.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=L.DivOverlay.prototype.getEvents.call(this);return L.Browser.touch&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=L.DomUtil.create("div",t)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var o=this._map,i=this._container,e=o.latLngToContainerPoint(o.getCenter()),n=o.layerPointToContainerPoint(t),s=this.options.direction,l=i.offsetWidth,p=i.offsetHeight,a=L.point(this.options.offset),r=this._getAnchor();"top"===s?t=t.add(L.point(-l/2+a.x,-p+a.y+r.y,!0)):"bottom"===s?t=t.subtract(L.point(l/2-a.x,-a.y,!0)):"center"===s?t=t.subtract(L.point(l/2+a.x,p/2-r.y+a.y,!0)):"right"===s||"auto"===s&&n.x<e.x?(s="right",t=t.add(L.point(a.x+r.x,r.y-p/2+a.y,!0))):(s="left",t=t.subtract(L.point(l+r.x-a.x,p/2-r.y-a.y,!0))),L.DomUtil.removeClass(i,"leaflet-tooltip-right"),L.DomUtil.removeClass(i,"leaflet-tooltip-left"),L.DomUtil.removeClass(i,"leaflet-tooltip-top"),L.DomUtil.removeClass(i,"leaflet-tooltip-bottom"),L.DomUtil.addClass(i,"leaflet-tooltip-"+s),L.DomUtil.setPosition(i,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&L.DomUtil.setOpacity(this._container,t)},_animateZoom:function(t){var o=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(o)},_getAnchor:function(){return L.point(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),L.tooltip=function(t,o){return new L.Tooltip(t,o)},L.Map.include({openTooltip:function(t,o,i){return t instanceof L.Tooltip||(t=new L.Tooltip(i).setContent(t)),o&&t.setLatLng(o),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),L.Layer.include({bindTooltip:function(t,o){return t instanceof L.Tooltip?(L.setOptions(t,o),this._tooltip=t,t._source=this):(this._tooltip&&!o||(this._tooltip=L.tooltip(o,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var o=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),L.Browser.touch&&(i.click=this._openTooltip)),this[o](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t,o){if(t instanceof L.Layer||(o=t,t=this),t instanceof L.FeatureGroup)for(var i in this._layers){t=this._layers[i];break}return o||(o=t.getCenter?t.getCenter():t.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=t,this._tooltip.update(),this._map.openTooltip(this._tooltip,o),this._tooltip.options.interactive&&this._tooltip._container&&(L.DomUtil.addClass(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(L.DomUtil.removeClass(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var o=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(o,this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var o,i,e=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(o=this._map.mouseEventToContainerPoint(t.originalEvent),i=this._map.containerPointToLayerPoint(o),e=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(e)}});