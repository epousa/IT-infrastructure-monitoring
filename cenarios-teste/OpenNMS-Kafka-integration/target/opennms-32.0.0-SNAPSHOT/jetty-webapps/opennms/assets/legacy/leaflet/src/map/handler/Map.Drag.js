L.Map.mergeOptions({dragging:!0,inertia:!L.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0}),L.Map.Drag=L.Handler.extend({addHooks:function(){if(!this._draggable){var i=this._map;this._draggable=new L.Draggable(i._mapPane,i._container),this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),i.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),i.on("zoomend",this._onZoomEnd,this),i.whenReady(this._onZoomEnd,this))}L.DomUtil.addClass(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){L.DomUtil.removeClass(this._map._container,"leaflet-grab"),L.DomUtil.removeClass(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDown:function(){this._map._stop()},_onDragStart:function(){var i=this._map;if(this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=L.latLngBounds(this._map.options.maxBounds);this._offsetLimit=L.bounds(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;i.fire("movestart").fire("dragstart"),i.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(i){if(this._map.options.inertia){var t=this._lastTime=+new Date,s=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(s),this._times.push(t),t-this._times[0]>50&&(this._positions.shift(),this._times.shift())}this._map.fire("move",i).fire("drag",i)},_onZoomEnd:function(){var i=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(i).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(i,t){return i-(i-t)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var i=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;i.x<t.min.x&&(i.x=this._viscousLimit(i.x,t.min.x)),i.y<t.min.y&&(i.y=this._viscousLimit(i.y,t.min.y)),i.x>t.max.x&&(i.x=this._viscousLimit(i.x,t.max.x)),i.y>t.max.y&&(i.y=this._viscousLimit(i.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(i)}},_onPreDragWrap:function(){var i=this._worldWidth,t=Math.round(i/2),s=this._initialWorldOffset,a=this._draggable._newPos.x,o=(a-t+s)%i+t-s,e=(a+t+s)%i-t-s,n=Math.abs(o+s)<Math.abs(e+s)?o:e;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=n},_onDragEnd:function(i){var t=this._map,s=t.options,a=!s.inertia||this._times.length<2;if(t.fire("dragend",i),a)t.fire("moveend");else{var o=this._lastPos.subtract(this._positions[0]),e=(this._lastTime-this._times[0])/1e3,n=s.easeLinearity,r=o.multiplyBy(n/e),_=r.distanceTo([0,0]),h=Math.min(s.inertiaMaxSpeed,_),d=r.multiplyBy(h/_),g=h/(s.inertiaDeceleration*n),m=d.multiplyBy(-g/2).round();m.x||m.y?(m=t._limitOffset(m,t.options.maxBounds),L.Util.requestAnimFrame((function(){t.panBy(m,{duration:g,easeLinearity:n,noMoveStart:!0,animate:!0})}))):t.fire("moveend")}}}),L.Map.addInitHook("addHandler","dragging",L.Map.Drag);