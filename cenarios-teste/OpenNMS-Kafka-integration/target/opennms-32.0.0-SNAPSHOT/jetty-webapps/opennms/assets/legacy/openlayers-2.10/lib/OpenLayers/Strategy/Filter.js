OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,initialize:function(e){if(OpenLayers.Strategy.prototype.initialize.apply(this,[e]),!(this.filter&&this.filter instanceof OpenLayers.Filter))throw new Error("Filter strategy must be constructed with a filter")},activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return e&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})),e},deactivate:function(){return this.cache=null,this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}),OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(e){if(!this.caching){var t,a=e.features;e.features=[];for(var i=0,s=a.length;i<s;++i)t=a[i],this.filter.evaluate(t)?e.features.push(t):this.cache.push(t)}},handleRemove:function(e){this.caching||(this.cache=[])},setFilter:function(e){this.filter=e;var t=this.cache;if(this.cache=[],this.handleAdd({features:this.layer.features}),this.cache.length>0&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice(),{silent:!0}),this.caching=!1),t.length>0){var a={features:t};this.handleAdd(a),this.caching=!0,this.layer.addFeatures(a.features,{silent:!0}),this.caching=!1}},CLASS_NAME:"OpenLayers.Strategy.Filter"});