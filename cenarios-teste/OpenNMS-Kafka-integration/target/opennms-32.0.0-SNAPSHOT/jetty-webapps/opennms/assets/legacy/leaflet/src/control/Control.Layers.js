L.Control.Layers=L.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,a,i){return a<i?-1:i<a?1:0}},initialize:function(e,t,a){for(var i in L.setOptions(this,a),this._layers=[],this._lastZIndex=0,this._handlingClick=!1,e)this._addLayer(e[i],i);for(i in t)this._addLayer(t[i],i,!0)},onAdd:function(e){return this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this),this._container},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(L.stamp(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._form.clientHeight?(L.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=e+"px"):L.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return L.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=L.DomUtil.create("div",e);t.setAttribute("aria-haspopup",!0),L.DomEvent.disableClickPropagation(t),L.Browser.touch||L.DomEvent.disableScrollPropagation(t);var a=this._form=L.DomUtil.create("form",e+"-list");L.Browser.android||L.DomEvent.on(t,{mouseenter:this.expand,mouseleave:this.collapse},this);var i=this._layersLink=L.DomUtil.create("a",e+"-toggle",t);i.href="#",i.title="Layers",L.Browser.touch?L.DomEvent.on(i,"click",L.DomEvent.stop).on(i,"click",this.expand,this):L.DomEvent.on(i,"focus",this.expand,this),L.DomEvent.on(a,"click",(function(){setTimeout(L.bind(this._onInputClick,this),0)}),this),this._map.on("click",this.collapse,this),this.options.collapsed||this.expand(),this._baseLayersList=L.DomUtil.create("div",e+"-base",a),this._separator=L.DomUtil.create("div",e+"-separator",a),this._overlaysList=L.DomUtil.create("div",e+"-overlays",a),t.appendChild(a)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&L.stamp(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,a){e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:a}),this.options.sortLayers&&this._layers.sort(L.bind((function(e,t){return this.options.sortFunction(e.layer,t.layer,e.name,t.name)}),this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex))},_update:function(){if(!this._container)return this;L.DomUtil.empty(this._baseLayersList),L.DomUtil.empty(this._overlaysList);var e,t,a,i,s=0;for(a=0;a<this._layers.length;a++)i=this._layers[a],this._addItem(i),t=t||i.overlay,e=e||!i.overlay,s+=i.overlay?0:1;return this.options.hideSingleBase&&(e=e&&s>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(L.stamp(e.target)),a=t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;a&&this._map.fire(a,t)},_createRadioElement:function(e,t){var a='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=a,i.firstChild},_addItem:function(e){var t,a=document.createElement("label"),i=this._map.hasLayer(e.layer);e.overlay?((t=document.createElement("input")).type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=i):t=this._createRadioElement("leaflet-base-layers",i),t.layerId=L.stamp(e.layer),L.DomEvent.on(t,"click",this._onInputClick,this);var s=document.createElement("span");s.innerHTML=" "+e.name;var o=document.createElement("div");return a.appendChild(o),o.appendChild(t),o.appendChild(s),(e.overlay?this._overlaysList:this._baseLayersList).appendChild(a),this._checkDisabledLayers(),a},_onInputClick:function(){var e,t,a,i=this._form.getElementsByTagName("input"),s=[],o=[];this._handlingClick=!0;for(var n=i.length-1;n>=0;n--)e=i[n],t=this._getLayer(e.layerId).layer,a=this._map.hasLayer(t),e.checked&&!a?s.push(t):!e.checked&&a&&o.push(t);for(n=0;n<o.length;n++)this._map.removeLayer(o[n]);for(n=0;n<s.length;n++)this._map.addLayer(s[n]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var e,t,a=this._form.getElementsByTagName("input"),i=this._map.getZoom(),s=a.length-1;s>=0;s--)e=a[s],t=this._getLayer(e.layerId).layer,e.disabled=void 0!==t.options.minZoom&&i<t.options.minZoom||void 0!==t.options.maxZoom&&i>t.options.maxZoom},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),L.control.layers=function(e,t,a){return new L.Control.Layers(e,t,a)};