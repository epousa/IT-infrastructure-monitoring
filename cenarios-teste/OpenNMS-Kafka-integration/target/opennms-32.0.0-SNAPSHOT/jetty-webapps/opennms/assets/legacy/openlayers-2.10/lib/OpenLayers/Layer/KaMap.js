OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,units:null,resolution:OpenLayers.DOTS_PER_INCH,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(e,t,i,a){var s=[];s.push(e,t,i,a),OpenLayers.Layer.Grid.prototype.initialize.apply(this,s),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round(1e4*this.map.getScale())/1e4,a=Math.round(e.left/t),s=-Math.round(e.top/t);return this.getFullRequestString({t:s,l:a,s:i})},addTile:function(e,t){var i=this.getURL(e);return new OpenLayers.Tile.Image(this,t,e,i,this.tileSize)},calculateGridLayout:function(e,t,i){var a=i*this.tileSize.w,s=i*this.tileSize.h,l=e.left,n=Math.floor(l/a)-this.buffer,r=-(l/a-n)*this.tileSize.w,o=n*a,h=e.top,p=Math.ceil(h/s)+this.buffer;return{tilelon:a,tilelat:s,tileoffsetlon:o,tileoffsetlat:p*s,tileoffsetx:r,tileoffsety:-(p-h/s+1)*this.tileSize.h}},clone:function(e){return null==e&&(e=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e},getTileBounds:function(e){var t=this.getResolution(),i=t*this.tileSize.w,a=t*this.tileSize.h,s=this.getLonLatFromViewPortPx(e),l=i*Math.floor(s.lon/i),n=a*Math.floor(s.lat/a);return new OpenLayers.Bounds(l,n,l+i,n+a)},CLASS_NAME:"OpenLayers.Layer.KaMap"});