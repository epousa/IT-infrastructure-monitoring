L.TileLayer=L.GridLayer.extend({options:{minZoom:0,maxZoom:18,maxNativeZoom:null,minNativeZoom:null,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(o,i){this._url=o,(i=L.setOptions(this,i)).detectRetina&&L.Browser.retina&&i.maxZoom>0&&(i.tileSize=Math.floor(i.tileSize/2),i.zoomReverse?(i.zoomOffset--,i.minZoom++):(i.zoomOffset++,i.maxZoom--),i.minZoom=Math.max(0,i.minZoom)),"string"==typeof i.subdomains&&(i.subdomains=i.subdomains.split("")),L.Browser.android||this.on("tileunload",this._onTileRemove)},setUrl:function(o,i){return this._url=o,i||this.redraw(),this},createTile:function(o,i){var t=document.createElement("img");return L.DomEvent.on(t,"load",L.bind(this._tileOnLoad,this,i,t)),L.DomEvent.on(t,"error",L.bind(this._tileOnError,this,i,t)),this.options.crossOrigin&&(t.crossOrigin=""),t.alt="",t.setAttribute("role","presentation"),t.src=this.getTileUrl(o),t},getTileUrl:function(o){var i={r:L.Browser.retina?"@2x":"",s:this._getSubdomain(o),x:o.x,y:o.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var t=this._globalTileRange.max.y-o.y;this.options.tms&&(i.y=t),i["-y"]=t}return L.Util.template(this._url,L.extend(i,this.options))},_tileOnLoad:function(o,i){L.Browser.ielt9?setTimeout(L.bind(o,this,null,i),0):o(null,i)},_tileOnError:function(o,i,t){var e=this.options.errorTileUrl;e&&(i.src=e),o(t,i)},getTileSize:function(){var o=this._map,i=L.GridLayer.prototype.getTileSize.call(this),t=this._tileZoom+this.options.zoomOffset,e=this.options.minNativeZoom,n=this.options.maxNativeZoom;return null!==e&&t<e?i.divideBy(o.getZoomScale(e,t)).round():null!==n&&t>n?i.divideBy(o.getZoomScale(n,t)).round():i},_onTileRemove:function(o){o.tile.onload=null},_getZoomForUrl:function(){var o=this._tileZoom,i=this.options.maxZoom,t=this.options.zoomReverse,e=this.options.zoomOffset,n=this.options.minNativeZoom,s=this.options.maxNativeZoom;return t&&(o=i-o),o+=e,null!==n&&o<n?n:null!==s&&o>s?s:o},_getSubdomain:function(o){var i=Math.abs(o.x+o.y)%this.options.subdomains.length;return this.options.subdomains[i]},_abortLoading:function(){var o,i;for(o in this._tiles)this._tiles[o].coords.z!==this._tileZoom&&((i=this._tiles[o].el).onload=L.Util.falseFn,i.onerror=L.Util.falseFn,i.complete||(i.src=L.Util.emptyImageUrl,L.DomUtil.remove(i)))}}),L.tileLayer=function(o,i){return new L.TileLayer(o,i)};